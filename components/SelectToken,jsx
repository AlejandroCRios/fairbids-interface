import { useEffect } from "react";

import { Button, HStack, Text, Image } from "@chakra-ui/react";

import { useStateInfo } from "../../context/state-context";
import { useSwapInfo } from "../../context/swap-context";
import { ChevronDownIcon } from "@chakra-ui/icons";

import { useAccount, useNetwork } from "wagmi";

const SelectTokenOne = ({ addressSpender }) => {
  const { data: account } = useAccount();
  const { activeChain: chain } = useNetwork();
  const { onOpenSel, setSelectOne } = useStateInfo();
  const {
    tokenOne_token,
    tokenTwo_token,
    setTokenOne_allowed,
    readTokenAllowance,
    getPairInfo,
    getPairContract,
    getPairReserve,
  } = useSwapInfo();

  useEffect(() => {
    if (tokenOne_token && account) {
      readTokenAllowance(tokenOne_token, addressSpender, setTokenOne_allowed);
    }

    const readPairData = async () => {
      if (tokenOne_token && tokenTwo_token) {
        const pairInfo = await getPairInfo();
        const pairContract = await getPairContract(pairInfo);
        await getPairReserve(pairContract);
      }
    };
    readPairData();
  }, [tokenOne_token, chain, account]);

  return (
    <Button
      colorScheme={"gray"}
      color={"blackAlpha.800"}
      size={"sm"}
      onClick={() => {
        setSelectOne(true);
        onOpenSel();
      }}
    >
      <HStack align={"center"} justify={"center"} px={2}>
        <Image
          src={tokenOne_token?.iconUrl}
          h={"24px"}
          w={"24px"}
          alt="icon"
          mr={"3px"}
        ></Image>
        <Text color={"blackAlpha.800"} fontSize={{ base: "14px", md: "16px" }}>
          {tokenOne_token?.symbol}
        </Text>
        <ChevronDownIcon w={{ base: 5, md: 5 }} h={{ base: 5, md: 5 }} />
      </HStack>
    </Button>
  );
};

export default SelectTokenOne;
